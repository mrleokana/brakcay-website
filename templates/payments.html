{% extends "base.html" %}
{% block title %}Payments â€” BraKcay{% endblock %}

{% block content %}
<section class="payments-section">
  <h2>Make a Payment</h2>
  <p>Choose your payment method. (Dummy functionality for testing)</p>

  {% if result %}
    {% if result.status=='success' %}
      <div class="payment-success">
        <p>Payment Successful!</p>
        <p>Method: {{ result.method }}</p>
        <p>Amount: {{ result.amount }}</p>
        <p>Transaction ID: {{ result.tx_id }}</p>
        <p>Time: {{ result.time }}</p>
      </div>
    {% else %}
      <div class="payment-error">
        <p>Error: {{ result.message }}</p>
      </div>
    {% endif %}
  {% endif %}

  <form method="POST" id="payment-form">
    <label>Amount (USD)</label>
    <input type="number" name="amount" min="1" required>

    <label>Payment Method</label>
    <select name="payment-method" id="payment-method" required>
      <option value="visa">Visa/MasterCard</option>
      <option value="mpesa">Mpesa</option>
      <option value="ecocash">EcoCash</option>
      <option value="crypto">Cryptocurrency</option>
    </select>

    <!-- Visa/MasterCard Fields -->
    <div id="visa-fields" class="payment-fields">
      <label>Card Number</label>
      <input type="text" name="card-number" placeholder="1234 5678 9012 3456">
      <label>Expiry (MM/YY)</label>
      <input type="text" name="expiry" placeholder="12/25">
      <label>CVV</label>
      <input type="text" name="cvv" placeholder="123">
    </div>

    <!-- Mpesa Fields -->
    <div id="mpesa-fields" class="payment-fields" style="display:none;">
      <label>Mpesa Number</label>
      <input type="text" name="mpesa-number" placeholder="07XXXXXXXX">
    </div>

    <!-- EcoCash Fields -->
    <div id="ecocash-fields" class="payment-fields" style="display:none;">
      <label>EcoCash Number</label>
      <input type="text" name="ecocash-number" placeholder="07XXXXXXXX">
    </div>

    <!-- Cryptocurrency Fields -->
    <div id="crypto-fields" class="payment-fields" style="display:none;">
      <label>Cryptocurrency</label>
      <select name="crypto-coin" id="crypto-coin">
        <option value="">-- Select Coin --</option>
        <option value="BTC">Bitcoin (BTC)</option>
        <option value="ETH">Ethereum (ETH)</option>
        <option value="USDT">USDT</option>
        <option value="BNB">Binance Coin (BNB)</option>
      </select>
      <div id="crypto-wallet" style="display:none;">
        <label>Wallet Address</label>
        <input type="text" name="wallet-address" placeholder="0x...">
      </div>
    </div>

    <button type="submit">Pay Now</button>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const paymentSelect = document.getElementById('payment-method');
  const fields = {
    visa: document.getElementById('visa-fields'),
    mpesa: document.getElementById('mpesa-fields'),
    ecocash: document.getElementById('ecocash-fields'),
    crypto: document.getElementById('crypto-fields')
  };
  const cryptoSelect = document.getElementById('crypto-coin');
  const cryptoWallet = document.getElementById('crypto-wallet');
  const cardInput = document.querySelector('input[name="card-number"]');

  // Format card number visually
  if (cardInput) {
    cardInput.addEventListener('input', function(e) {
      this.value = this.value.replace(/[^\d]/g, '').replace(/(.{4})/g, '$1 ').trim();
    });
  }

  function toggleFields() {
    Object.values(fields).forEach(f => f.style.display = 'none');
    const selected = paymentSelect.value || 'visa';
    if (fields[selected]) fields[selected].style.display = 'block';
    // hide crypto wallet unless coin selected
    if (selected !== 'crypto') cryptoWallet.style.display = 'none';
  }

  // Show wallet input only if coin selected
  cryptoSelect.addEventListener('change', function() {
    if (this.value) {
      cryptoWallet.style.display = 'block';
    } else {
      cryptoWallet.style.display = 'none';
    }
  });

  if (!paymentSelect.value) paymentSelect.value = 'visa';
  toggleFields();
  paymentSelect.addEventListener('change', toggleFields);
});
</script>
{% endblock %}
